# PLC CNC 模拟测试程序

## 功能说明

这个程序用于模拟CNC设备的PLC数据更新，主要功能包括：

- 每1秒随机选择CNC01-16中的一个设备
- 将选中设备的点位值加1
- 实际写入到PLC中，用于测试大屏和采集程序的数据更新功能

## 使用方法

### 方法1：使用批处理文件（推荐）

1. 双击运行 `启动PLC模拟测试.bat`
2. 按任意键开始测试
3. 按 `Ctrl+C` 停止测试

### 方法2：使用命令行

1. 打开命令提示符或PowerShell
2. 切换到程序目录：`cd "c:\Users\10256\Desktop\S3 0811\PLC_CNC_TEST"`
3. 运行程序：`dotnet run`
4. 按 `Ctrl+C` 停止测试

## 配置说明

程序中的PLC连接配置：

- **PLC地址**: 192.168.1.100
- **端口**: 502
- **协议**: Modbus TCP

## CNC设备地址映射

| 设备名称 | Modbus地址 |
|----------|------------|
| CNC01    | 0          |
| CNC02    | 1          |
| CNC03    | 2          |
| CNC04    | 3          |
| CNC05    | 4          |
| CNC06    | 5          |
| CNC07    | 6          |
| CNC08    | 7          |
| CNC09    | 8          |
| CNC10    | 9          |
| CNC11    | 10         |
| CNC12    | 11         |
| CNC13    | 12         |
| CNC14    | 13         |
| CNC15    | 14         |
| CNC16    | 15         |

## 程序输出示例

```
=== PLC CNC 模拟测试程序 ===
按 Ctrl+C 停止测试
正在连接到PLC: 192.168.1.100:502
✓ 成功连接到PLC
开始模拟CNC数据更新...
✓ CNC05 (地址: 4): 15 → 16
✓ CNC12 (地址: 11): 23 → 24
✓ CNC03 (地址: 2): 18 → 19
统计: 总计 10 次，成功 10 次，成功率 100.0%
```

## 注意事项

1. 确保PLC设备已启动并可访问
2. 确保网络连接正常
3. 程序会自动处理连接断开并尝试重连
4. 每10次操作会显示一次统计信息
5. 程序结束时会显示最终统计结果

## 故障排除

### 连接失败
- 检查PLC设备是否启动
- 检查网络连接
- 确认PLC地址和端口配置正确

### 编译错误
- 确保已安装.NET 6.0或更高版本
- 运行 `dotnet restore` 恢复NuGet包

### 权限问题
- 以管理员身份运行程序
- 检查防火墙设置