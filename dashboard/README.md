# S3 PLC数据采集监控大屏

## 项目简介

这是一个基于Web的S3 PLC数据采集监控大屏系统，能够实时显示16台CNC设备的采集数据和运行状态。

## 功能特性

- **实时数据显示**: 从SQLite数据库获取CNC设备的实时采集数据
- **设备状态监控**: 显示设备运行状态（运行中、待机、维修中）
- **统计信息**: 显示总设备数、各状态设备数量、总采集量等统计信息
- **响应式设计**: 支持不同屏幕尺寸的自适应布局
- **自动刷新**: 每5秒自动从数据库获取最新数据

## 系统架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   S3 PLC设备    │───▶│  数据采集服务    │───▶│   SQLite数据库   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   监控大屏      │◀───│   Node.js API   │◀───│   数据库查询     │
│  (Web界面)      │    │     服务器       │    └─────────────────┘
└─────────────────┘    └─────────────────┘
```

## 安装和运行

### 前置条件

- Node.js 14.0.0 或更高版本
- S3 PLC数据采集服务正在运行
- SQLite数据库文件 `plc_data.db` 存在

### 安装步骤

1. 进入dashboard目录：
   ```bash
   cd "C:\Users\10256\Desktop\S3 0811\dashboard"
   ```

2. 安装依赖：
   ```bash
   npm install
   ```

3. 启动API服务器：
   ```bash
   npm start
   ```

4. 打开浏览器访问：
   ```
   http://localhost:3000
   ```

## API接口

### GET /api/cnc-devices

获取CNC设备数据和统计信息。

**响应示例：**
```json
{
  "success": true,
  "timestamp": "2025-08-12T00:55:43.810Z",
  "stats": {
    "total": 16,
    "running": 16,
    "standby": 0,
    "offline": 0,
    "totalCount": 144
  },
  "devices": [
    {
      "id": "CNC-01",
      "name": "CNC-01",
      "status": "running",
      "count": 13,
      "address": "866",
      "lastUpdate": "2025-08-12T08:49:43.000Z",
      "workOrder": "WO866",
      "startTime": "08:49:43"
    }
  ]
}
```

### GET /api/device-status

获取所有设备的详细状态信息。

## 设备状态说明

- **运行中 (running)**: 设备正在运行，采集数量大于0
- **待机 (standby)**: 设备已连接但暂停工作，最近10分钟内有数据更新
- **维修中 (offline)**: 设备离线或超过10分钟未更新数据

## 数据库映射

系统从以下数据库表获取数据：

- **device_config**: 设备配置信息
- **device_data**: 实时设备数据
- **v_current_device_status**: 当前设备状态视图

CNC设备地址映射：
- CNC-01 ~ CNC-16 对应 D866 ~ D896 地址

## 文件结构

```
dashboard/
├── api-server.js          # Node.js API服务器
├── cnc-dashboard.html     # 监控大屏HTML页面
├── package.json           # Node.js项目配置
├── node_modules/          # 依赖包目录
└── README.md             # 项目说明文档
```

## 故障排除

### 1. 数据连接失败

如果页面显示"数据连接失败"错误：

- 检查API服务器是否正在运行（端口3000）
- 确认数据库文件 `plc_data.db` 存在
- 检查S3 PLC数据采集服务是否正常运行

### 2. 设备数据为空

如果设备显示采集数量为0：

- 检查PLC连接状态
- 确认设备配置是否正确
- 查看数据采集服务日志

### 3. 页面无法访问

- 确认Node.js服务器已启动
- 检查端口3000是否被占用
- 尝试重启API服务器

## 技术栈

- **前端**: HTML5, CSS3 (Tailwind CSS), JavaScript
- **后端**: Node.js, HTTP Server
- **数据库**: SQLite3
- **通信**: RESTful API, AJAX

## 更新日志

### v1.0.0 (2025-08-12)

- 初始版本发布
- 支持16台CNC设备监控
- 实时数据获取和显示
- 响应式设计界面
- RESTful API接口

## 联系信息

如有问题或建议，请联系开发团队。